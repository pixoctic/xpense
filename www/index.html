<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Xpense Pro Max</title>
    <style>
        /* --- PRO MAX THEME --- */
        :root { 
            --bg: #000000;
            --glass: rgba(22, 22, 24, 0.8);
            --glass-nav: rgba(10, 10, 10, 0.95);
            --border: rgba(255, 255, 255, 0.12);
            --primary: #3b82f6; --accent: #8b5cf6;
            --text: #ffffff; --sub: #9ca3af;
            --danger: #ef4444; --success: #10b981; --warn: #f59e0b;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg);
            color: var(--text); font-family: 'Inter', -apple-system, sans-serif; 
            margin: 0; padding-top: max(45px, env(safe-area-inset-top)); 
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* --- FX --- */
        .aura { position: fixed; width: 300px; height: 300px; filter: blur(90px); opacity: 0.25; z-index: -1; animation: float 10s infinite alternate; }
        .aura.blue { top: -50px; left: -50px; background: var(--primary); }
        .aura.purple { bottom: -50px; right: -50px; background: var(--accent); animation-delay: -5s; }
        @keyframes float { 0% { transform: translate(0,0); } 100% { transform: translate(40px, 40px); } }

        /* --- LOCK SCREEN --- */
        #lock-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .pin-dots { color: var(--primary); font-size: 30px; letter-spacing: 12px; margin-bottom: 40px; }
        .numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .num-btn { width: 75px; height: 75px; border-radius: 50%; border: 1px solid #333; font-size: 24px; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.05); transition:0.1s; }
        .num-btn:active { background: var(--primary); transform: scale(0.9); }

        /* --- HEADER --- */
        header { padding: 10px 24px; display: flex; justify-content: space-between; align-items: center; }
        .brand { font-size: 24px; font-weight: 800; background: linear-gradient(to right, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .profile-btn { width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--border); overflow: hidden; background: #222; position: relative; }
        .profile-btn img { width: 100%; height: 100%; object-fit: cover; }

        /* --- DASHBOARD --- */
        .dashboard { padding: 0 24px 20px; }
        .card { 
            background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: 24px; padding: 20px; 
            text-align: center; position: relative; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .bal-val { font-size: 42px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 8px; text-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
        .edit-pen { font-size: 14px; color: var(--sub); border: 1px solid #444; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; }

        /* BUDGET BAR */
        .budget-wrap { margin-top: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; height: 30px; position: relative; overflow: hidden; display:flex; align-items:center; padding: 0 10px; }
        .budget-fill { position: absolute; top:0; left:0; height:100%; background: linear-gradient(90deg, var(--primary), var(--accent)); opacity: 0.3; width: 0%; transition: 1s ease; }
        .budget-text { position: relative; z-index: 2; font-size: 11px; color: #fff; width: 100%; display: flex; justify-content: space-between; font-weight: 600; }
        .budget-line { position: absolute; bottom: 0; left: 0; height: 3px; background: var(--primary); width: 0%; transition: 1s ease; z-index: 3; }

        /* --- MONTH SELECTOR --- */
        .month-nav { display: flex; align-items: center; justify-content: center; gap: 20px; padding: 5px 0 15px; }
        .month-btn { background: none; border: none; color: var(--sub); font-size: 20px; cursor: pointer; padding: 10px; }
        .month-label { font-size: 16px; font-weight: 600; color: #fff; width: 140px; text-align: center; }

        /* --- VIEWS --- */
        .view-container { flex: 1; overflow-y: auto; padding-bottom: 100px; scroll-behavior: smooth; }
        .view { padding: 0 24px; display: none; animation: fadeIn 0.3s ease; }
        .view.active { display: block; }

        /* --- LIST & STATS --- */
        .txn { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .inc { color: var(--success); } .exp { color: var(--text); } .lent { color: var(--warn); }
        
        .stat-item { margin-bottom: 12px; }
        .stat-header { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 6px; color: var(--sub); }
        .stat-track { width: 100%; height: 8px; background: #222; border-radius: 4px; overflow: hidden; }
        .stat-fill { height: 100%; background: var(--primary); border-radius: 4px; }

        /* --- INPUTS --- */
        .input-box { width: 100%; background: #111; border: 1px solid var(--border); color: #fff; padding: 16px; border-radius: 14px; font-size: 16px; margin-bottom: 12px; outline: none; }
        .action-btn { width: 100%; padding: 16px; border-radius: 14px; border: none; font-size: 16px; font-weight: 700; margin-top: 10px; background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; }

        /* --- NAV --- */
        .bottom-nav { 
            position: fixed; bottom: 0; width: 100%; background: var(--glass-nav); backdrop-filter: blur(20px); border-top: 1px solid var(--border); 
            display: flex; justify-content: space-around; padding: 12px 0 calc(15px + env(safe-area-inset-bottom)); z-index: 100;
        }
        .nav-item { color: #666; font-size: 10px; text-align: center; width: 60px; }
        .nav-icon { font-size: 22px; margin-bottom: 2px; filter: grayscale(1); opacity: 0.5; transition: 0.2s; }
        .nav-item.active { color: var(--primary); }
        .nav-item.active .nav-icon { filter: grayscale(0); opacity: 1; transform: translateY(-3px); text-shadow: 0 0 10px var(--primary); }

        /* --- MODAL --- */
        #view-profile { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 2000; padding: 20px; text-align: center; overflow-y: auto; }
        .upload-area { width: 100px; height: 100px; border-radius: 50%; background: #222; margin: 40px auto 20px; position: relative; border: 2px dashed #444; overflow: hidden; }
        .upload-area img { width: 100%; height: 100%; object-fit: cover; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    
    <div class="aura blue"></div>
    <div class="aura purple"></div>

    <div id="lock-screen">
        <div class="pin-dots" id="pin-dots">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
        <div class="numpad" id="numpad"></div>
    </div>

    <header>
        <div class="brand">Xpense.</div>
        <div class="profile-btn" onclick="openProfile()">
            <img id="header-avatar" src="" style="display:none">
            <div id="header-ph" style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; color:#666">U</div>
        </div>
    </header>

    <div class="dashboard">
        <div class="card">
            <div style="font-size:11px; color:var(--sub); text-transform:uppercase; letter-spacing:1px" onclick="editBalance()">Net Balance</div>
            <div class="bal-val" onclick="editBalance()"><span id="balance">‚Çπ0</span> <div class="edit-pen">‚úé</div></div>
            
            <div class="budget-wrap" onclick="tab('stats', document.querySelectorAll('.nav-item')[1])">
                <div class="budget-fill" id="budget-fill"></div>
                <div class="budget-line" id="budget-line"></div>
                <div class="budget-text">
                    <span id="spent-display">‚Çπ0 Spent</span>
                    <span id="budget-display">Target: ‚Çπ20k</span>
                </div>
            </div>
        </div>
    </div>

    <div class="month-nav">
        <button class="month-btn" onclick="changeMonth(-1)">&#10094;</button>
        <div class="month-label" id="month-label">October 2025</div>
        <button class="month-btn" onclick="changeMonth(1)">&#10095;</button>
    </div>

    <div class="view-container">
        
        <div id="view-home" class="view active">
            <div class="input-box" style="padding:10px; background:rgba(255,255,255,0.05); display:flex; align-items:center; margin-bottom:15px">
                <span style="margin-right:10px">üîç</span>
                <input type="text" id="search-box" placeholder="Search this month..." style="background:none; border:none; color:white; width:100%; outline:none;" onkeyup="filterList()">
            </div>
            <div id="txn-list"></div>
        </div>

        <div id="view-stats" class="view">
            <h3 style="color:var(--sub); font-size:12px; margin-bottom:15px; text-transform:uppercase">Monthly Breakdown</h3>
            <div id="stats-container"></div>
            
            <div style="margin-top:30px; padding:20px; background:rgba(255,255,255,0.05); border-radius:16px;">
                <h4 style="margin:0 0 5px">Data Options</h4>
                <button class="action-btn" style="background:#222; margin-top:10px; font-size:14px" onclick="exportCSV()">Download CSV (Excel) üì•</button>
            </div>
        </div>

        <div id="view-add" class="view">
            <input type="number" id="amt" class="input-box" placeholder="‚Çπ Amount">
            <select id="type" class="input-box" onchange="toggleFields()">
                <option value="expense">Expense</option>
                <option value="income">Income</option>
                <option value="lent">Lent Money</option>
            </select>
            <select id="cat" class="input-box"></select>
            <div id="lent-fields" style="display:none">
                <input type="text" id="person" class="input-box" placeholder="Borrower Name">
            </div>
            <button class="action-btn" onclick="addTxn()">Save Transaction</button>
        </div>

        <div id="view-petrol" class="view">
            <div class="card" style="margin-bottom:15px">
                <div style="font-size:11px; color:var(--sub)">AVG MILEAGE</div>
                <div style="font-size:32px; font-weight:700; color:var(--success)" id="avg-mileage">--</div>
                <div style="font-size:12px; color:var(--sub)" id="odo-display">Odo: 0 km</div>
            </div>
            <div style="background:var(--glass); border:1px solid var(--border); border-radius:20px; padding:20px;">
                <div style="display:flex; gap:10px">
                    <input type="number" id="p-amt" class="input-box" placeholder="‚Çπ Total">
                    <input type="number" id="p-price" class="input-box" placeholder="‚Çπ /L" value="105">
                </div>
                <input type="number" id="p-odo" class="input-box" placeholder="Odometer">
                <button class="action-btn" onclick="logPetrol()">Log Fuel</button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="tab('home', this)"><div class="nav-icon">üè†</div>Activity</div>
        <div class="nav-item" onclick="tab('stats', this)"><div class="nav-icon">üìä</div>Stats</div>
        <div class="nav-item" onclick="tab('add', this)"><div class="nav-icon">‚ûï</div>Add</div>
        <div class="nav-item" onclick="tab('petrol', this)"><div class="nav-icon">‚õΩ</div>Fuel</div>
    </div>

    <div id="view-profile">
        <div style="position:absolute; top:20px; right:20px; font-size:30px; cursor:pointer" onclick="closeProfile()">&times;</div>
        <div class="upload-area" onclick="document.getElementById('file-in').click()">
            <img id="profile-preview" src="" style="display:none">
            <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; color:#666">üì∑</div>
        </div>
        <input type="file" id="file-in" accept="image/*" style="display:none" onchange="uploadImg()">
        
        <label style="color:var(--sub); font-size:12px; display:block; text-align:left; margin:10px 0 5px 5%">YOUR NAME</label>
        <input type="text" id="user-name-in" class="input-box" placeholder="Name">
        
        <label style="color:var(--sub); font-size:12px; display:block; text-align:left; margin:10px 0 5px 5%">MONTHLY BUDGET LIMIT (‚Çπ)</label>
        <input type="number" id="user-budget-in" class="input-box" placeholder="20000">

        <button class="action-btn" onclick="saveProfile()">Save Settings</button>
        <button class="action-btn" style="background:#222; margin-top:20px; color:var(--danger)" onclick="if(confirm('Delete All Data?')) { localStorage.clear(); location.reload(); }">Reset App</button>
    </div>

    <script>
        // CONFIG
        const PIN = "121013";
        let inputPin = "";
        let txns = JSON.parse(localStorage.getItem('x_txns')) || [];
        let petrol = JSON.parse(localStorage.getItem('x_petrol')) || [];
        let user = JSON.parse(localStorage.getItem('x_user')) || { name: 'User', img: null, budget: 20000 };
        let lastOdo = localStorage.getItem('x_odo') || 0;
        let cats = ['üçî Food', 'üõçÔ∏è Shopping', 'üé¨ Fun', 'üöå Travel', 'üè• Health', 'üè† Rent'];
        
        // TIME MACHINE
        let displayDate = new Date(); // Tracks the currently viewed month

        // INIT
        function init() {
            renderNumpad();
            loadProfile(); renderCats();
            refreshView(); // This loads list, stats, and budget for current month
        }

        // --- CORE LOGIC ---
        function refreshView() {
            // Update Month Label
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            document.getElementById('month-label').innerText = `${monthNames[displayDate.getMonth()]} ${displayDate.getFullYear()}`;

            // Filter Transactions for this Month
            const currentMonthStr = `${displayDate.getMonth()+1}/${displayDate.getFullYear()}`; // "10/2025" logic
            
            // Note: Date stored as "M/D/YYYY" or "D/M/YYYY" depending on locale. 
            // We need robust checking.
            const filteredTxns = txns.filter(t => {
                const d = new Date(t.date);
                return d.getMonth() === displayDate.getMonth() && d.getFullYear() === displayDate.getFullYear();
            });

            renderList(filteredTxns);
            renderStats(filteredTxns);
            updateBudget(filteredTxns);
            updateBal(); // Balance is GLOBAL (all time), not just monthly
        }

        function changeMonth(dir) {
            displayDate.setMonth(displayDate.getMonth() + dir);
            refreshView();
        }

        // --- BUDGET BAR ---
        function updateBudget(monthlyTxns) {
            const spent = monthlyTxns.filter(t => t.type === 'expense').reduce((a,b)=>a+b.amt,0);
            const limit = user.budget || 20000;
            const pct = Math.min((spent / limit) * 100, 100);
            
            document.getElementById('spent-display').innerText = `‚Çπ${spent} Spent`;
            document.getElementById('budget-display').innerText = `Target: ‚Çπ${limit}`;
            
            const fill = document.getElementById('budget-fill');
            const line = document.getElementById('budget-line');
            
            fill.style.width = pct + "%";
            line.style.width = pct + "%";
            
            // Colors
            let color = 'var(--primary)'; // Blue/Green
            if(pct > 50) color = 'var(--warn)'; // Yellow
            if(pct > 90) color = 'var(--danger)'; // Red
            
            line.style.background = color;
            fill.style.background = `linear-gradient(90deg, ${color}, transparent)`;
        }

        // --- TRANSACTIONS ---
        function addTxn() {
            const amt = parseFloat(document.getElementById('amt').value);
            const type = document.getElementById('type').value;
            const cat = document.getElementById('cat').value;
            if(!amt) return;

            // Save Date as standard format for parsing
            let txn = { id: Date.now(), amt, type, cat, date: new Date().toLocaleDateString('en-US') }; 
            if(type === 'lent') { txn.person = document.getElementById('person').value || 'Unknown'; txn.cat = 'Lent: '+txn.person; }
            
            txns.unshift(txn); localStorage.setItem('x_txns', JSON.stringify(txns));
            document.getElementById('amt').value = '';
            
            // Jump to current month to see new txn
            displayDate = new Date(); 
            refreshView();
            tab('home', document.querySelectorAll('.nav-item')[0]);
        }

        function renderList(data) {
            document.getElementById('txn-list').innerHTML = data.length ? data.map(t => `
                <div class="txn">
                    <div><div style="font-weight:600">${t.cat}</div><div style="font-size:12px; color:var(--sub)">${new Date(t.date).toLocaleDateString()}</div></div>
                    <div class="${t.type==='income'?'inc':(t.type==='lent'?'lent':'exp')}">${t.type==='income'?'+':'-'}‚Çπ${t.amt}</div>
                </div>`).join('') : `<div style="text-align:center; padding:20px; color:var(--sub)">No transactions this month.</div>`;
        }

        function renderStats(data) {
            const map = {};
            let total = 0;
            data.filter(t => t.type === 'expense').forEach(t => {
                map[t.cat] = (map[t.cat] || 0) + t.amt;
                total += t.amt;
            });
            
            let html = "";
            for(let [c, amt] of Object.entries(map)) {
                let pct = total > 0 ? (amt / total * 100) : 0;
                html += `
                <div class="stat-item">
                    <div class="stat-header"><span>${c}</span><span>‚Çπ${amt} (${Math.round(pct)}%)</span></div>
                    <div class="stat-track"><div class="stat-fill" style="width:${pct}%"></div></div>
                </div>`;
            }
            document.getElementById('stats-container').innerHTML = html || "<div style='text-align:center; color:var(--sub)'>No spending data.</div>";
        }

        // --- GLOBAL UTILS ---
        function calculateBal() { return txns.reduce((a,t) => t.type==='income'?a+t.amt:a-t.amt, 0); }
        function updateBal() { document.getElementById('balance').innerText = `‚Çπ${calculateBal()}`; }
        function editBalance() {
            let cur = calculateBal();
            let real = prompt(`Actual Bank Balance?`);
            if(real && !isNaN(real)) {
                let diff = parseFloat(real) - cur;
                if(diff !== 0) {
                    txns.unshift({ id: Date.now(), amt: Math.abs(diff), type: diff>0?'income':'expense', cat: '‚öôÔ∏è Correction', date: new Date().toLocaleDateString('en-US') });
                    localStorage.setItem('x_txns', JSON.stringify(txns));
                    refreshView();
                }
            }
        }

        // --- LOCK SCREEN ---
        function renderNumpad() {
            const pad = document.getElementById('numpad');
            [1,2,3,4,5,6,7,8,9,'C',0,'<'].forEach(n => {
                let b = document.createElement('div');
                b.className = 'num-btn'; b.innerText = n==='<'?'‚å´':n;
                b.onclick = () => handlePin(n);
                pad.appendChild(b);
            });
        }
        function handlePin(n) {
            if(navigator.vibrate) navigator.vibrate(5);
            if(n==='C') inputPin=""; 
            else if(n==='<') inputPin=inputPin.slice(0,-1); 
            else if(inputPin.length<6) inputPin+=n;
            document.getElementById('pin-dots').innerText = "‚Ä¢".repeat(inputPin.length);
            if(inputPin === PIN) document.getElementById('lock-screen').style.display='none';
        }

        // --- PETROL & PROFILE ---
        function logPetrol() {
            const amt = parseFloat(document.getElementById('p-amt').value);
            const price = parseFloat(document.getElementById('p-price').value);
            const odo = parseFloat(document.getElementById('p-odo').value);
            if(!amt || !price || !odo) return alert('Fill all fields');
            
            const litres = (amt/price).toFixed(2);
            let mileage = 0;
            if(lastOdo > 0 && odo > lastOdo) mileage = ((odo - lastOdo) / litres).toFixed(1);
            
            lastOdo = odo; localStorage.setItem('x_odo', odo);
            petrol.unshift({ date: new Date().toLocaleDateString('en-US'), amt, litres, mileage, odo });
            localStorage.setItem('x_petrol', JSON.stringify(petrol));
            
            // Add as Expense
            txns.unshift({ id: Date.now(), amt, type: 'expense', cat: '‚õΩ Petrol', date: new Date().toLocaleDateString('en-US') });
            localStorage.setItem('x_txns', JSON.stringify(txns));
            
            alert(`Mileage: ${mileage} km/L`);
            refreshView();
            document.getElementById('p-amt').value = '';
        }

        function saveProfile() {
            const name = document.getElementById('user-name-in').value;
            const budg = document.getElementById('user-budget-in').value;
            const img = document.getElementById('profile-preview').src;
            
            if(name) user.name = name;
            if(budg) user.budget = budg;
            if(img && img.startsWith('data:')) user.img = img;
            
            localStorage.setItem('x_user', JSON.stringify(user));
            loadProfile(); closeProfile(); refreshView();
        }
        
        function loadProfile() {
            if(user.img) { document.getElementById('header-avatar').src = user.img; document.getElementById('header-avatar').style.display='block'; document.getElementById('header-ph').style.display='none'; }
            document.getElementById('user-name-in').value = user.name;
            document.getElementById('user-budget-in').value = user.budget;
        }

        // HELPER
        function tab(view, el) {
            if(navigator.vibrate) navigator.vibrate(5);
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('view-'+view).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }
        function renderCats() { document.getElementById('cat').innerHTML = cats.map(c => `<option value="${c}">${c}</option>`).join(''); }
        function toggleFields() { document.getElementById('lent-fields').style.display = document.getElementById('type').value === 'lent' ? 'block' : 'none'; }
        function openProfile() { document.getElementById('view-profile').style.display='block'; }
        function closeProfile() { document.getElementById('view-profile').style.display='none'; }
        function uploadImg() { const f = document.getElementById('file-in').files[0]; const r = new FileReader(); r.onload = e => { document.getElementById('profile-preview').src=e.target.result; document.getElementById('profile-preview').style.display='block'; }; if(f) r.readAsDataURL(f); }
        function exportCSV() {
            let csv = "Date,Type,Category,Amount\n" + txns.map(t => `${t.date},${t.type},${t.cat},${t.amt}`).join("\n");
            let link = document.createElement("a"); link.href = "data:text/csv;charset=utf-8," + encodeURI(csv); link.download = "xpense_data.csv"; link.click();
        }

        init();
    </script>
</body>
</html>